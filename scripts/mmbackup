#!/bin/bash

datestr=`date +%Y%m%d`
backup_path="/home/mmbackup"
backup_file=$backup_path/backup-${datestr}.tar.bz2

if [ ! -e "$backup_path" ]; then
    mkdir -p $backup_path
fi

tar cfj ${backup_file} -C / etc/cron.daily/mmbackup etc/exim4/ etc/lighttpd/ etc/mailman/ var/lib/mailman/archives/ var/lib/mailman/lists/ var/lib/mailman/data/ var/lib/exim4/config.autogenerated

# Delete any backups older than 14 days
find $backup_path -mtime +14 -name "backup-*.tar.bz2" -exec rm {} \;
